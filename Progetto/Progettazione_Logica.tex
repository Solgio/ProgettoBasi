\section{Progettazione Logica}

In questa sezione viene illustrato il processo di “traduzione” dello schema concettuale in uno schema logico, con l’obiettivo di rappresentare i dati in modo preciso
ed efficiente. Il primo passo consiste nell’analizzare le eventuali ridondanze nel modello, al fine di ottimizzare la struttura complessiva. Successivamente, si procede
con l’eliminazione delle due generalizzazioni. Infine, viene presentato il diagramma
ristrutturato, con una descrizione delle modifiche apportate.

\subsection{Analisi Rindondanze}

L'attributo PACCHIATTIVI in CORRIERE esprime il numero di pacchi non ancora consegnati che sono associati a ogni corriere. Ciò corrisponde a una ridondanza dato che si tratta di un numero calcolabile contando, per ogni corriere, il numero di pacchi il cui corrispettivo TRACKING ha l'attributo STATUS diverso da \textit{"Consegnato"}.
Questo attributo viene modificato ogni volta che un pacco viene consegnato o associato al corriere. Viene invece visualizzato ogni mezz'ora per monitorare l'operato di ogni corriere. Il numero di pacchi associati al giorno per un corriere è in media di 120\footnote{\href{https://www.dire.it/26-02-2019/301816-video-a-milano-la-rabbia-dei-corrieri-di-amazon-quattro-minuti-a-consegna-troppo-pochi/}{Fonte di riferimento per i "120 pacchi al giorno". 2019}}.\\
Questo si riassume nelle due seguenti operazioni:
\begin{itemize}
    \item \textbf{Operazione 1 (120 volte al giorno)}: memorizza il numero di pacchi non consegnati associati ad ogni corriere.
    \item \textbf{Operazione 2 (48 volte al giorno)}: visualizza il numero di pacchi non consegnati associati ad ogni corriere
\end{itemize}


\begin{comment}
\begin{center}
\begin{table}[]
    \centering
    \begin{tabular}{|m{4em}|m{10em}|m{15em}|m{7em}|}
    \hline
    \textbf{Entità} & \textbf{Descrizione} & \textbf{Attributi} & \textbf{Identificatore} \\ [0.5ex] 
    \hline\hline
        Filiale & Filiale di un'azienda di spedizione & Nome, Città, Tipo, Indirizzo & Nome, Città\\
        \hline
         Tracking & Storico del Tracking di un pacco & DataOra, IdPacco, Status, Note, NomeCheckPoint, CittàCheckPoint & IdPacco, DataOra\\
         \hline
        Pacco & Elemento spedito & Id, Tipologia, Dimensioni, Costo, DataOrdine, DataSpedizione & Id\\
        \hline
        Pacchi Assicurati & Pacco Assicurato & TipoAssicurazione &  \\
        \hline
        Pacchi Regalo & Pacco Regalo & Dedica, TipoCarta &  \\
        \hline
        Cliente & Proprietario del Pacco & Email, Nome, Cognome, Indirizzo, Telefono & Email\\
        \hline
        Corriere & Addetto alla spedizione di un pacco & C.F., Grado, Disponibilità, PacchiAttivi & C.F.\\
        \hline
    \end{tabular}
    \caption{Tabella delle Entità}
    \label{tab:entità}
\end{table}
\end{center}

\begin{center}
\begin{table}[]
    \centering
    \begin{tabular}{|m{4em}|m{10em}|m{15em}|m{7em}|}
    \hline
    \textbf{Relazione} & \textbf{Descrizione} & \textbf{Componente} & \textbf{Attributi}  \textbf \\ [0.5ex] 
    \hline\hline
        Sede & Sede di un Corriere & Corriere, Filiale & Attuale\\
        \hline
         Transito & Posizione Pacco & Tracking, Filiale & \\
         \hline
        Status & Informazioni sul tracciamento del pacco & Pacco, Tracking & \\
        \hline
        Contiene & Composizione dei Bundle & Pacco,Bundle & Quantità \\
        \hline
        Ordine & Ordine di un pacco di un cliente & Cliente, Pacco &  \\
        \hline
        Consegna & Consegna di un pacco da parte di un Corriere & Corriere, Pacco & \\
        \hline
    \end{tabular}
    \caption{Tabella delle Entità}
    \label{tab:entità}
\end{table}
\end{center}
\end{comment}

\subsection{Eliminazione delle Generalizzazioni}

Le generalizzazioni descritte in Sezione 3 vengono eliminate attraverso una ristrutturazione dello schema concettuale, con l’obiettivo di semplificare la successiva implementazione del modello relazionale e ridurre la presenza di valori nulli. Le modifiche
vengono applicate come segue:

\textbf{PACCHI}: La generalizzazione parziale di PACCHI viene rimossa tramite tre operazioni distinte che si occupano delle tre entità figlie, realizzando dunque una soluzione "ibrida".\\
Per PACCHI ASSICURATI e per PACCHI REGALO si è deciso di sostituire la generalizzazione con l'accorpamento delle due entità figlie nel padre. Le due entità figlie verranno dunque eliminate e la loro funzione sarà sostituita da degli attributi che saranno attribuiti all'entità padre. Questa scelta si giustifica di fronte al basso livello di "profondità" e "annidamento" degli attributi delle entità figlie in questione. Infatti queste entità non hanno relazioni con altre entità che non siano quella padre. Ne consegue dunque che l'introduzione di ulteriori attributi nel padre produce una quantità di valori NULL limitata, che non produce un effetto a cascata su ulteriori entità. Infatti in questo caso la presenza di valori NULL negli attributi sostituivi sarà dunque limitata a soli tre attributi.\\
L'entità figlia BUNDLE dispone già di per sé di una relazione con l'entità padre e merita dunque un trattamento differente.\\
Incorporarla direttamente nella relazione padre renderebbe la sua gestione particolarmente complessa, con la necessità dell'aggiunta di numerosi attributi per mantenere l'insieme delle caratteristiche originali. Questo corrisponderebbe tra l'altro a un numero rilevante di attributi che si troverebbero poi molto spesso a essere messi a NULL (nel caso di un non-BUNDLE). 
Un'altra opzione consisterebbe  nell'aggiungere un'altra relazione tra BUNDLE e PACCHI, riducendo in questo caso il numero di potenziali NULL. In questo caso però si avrebbero però due relazioni e due entità per gestire una struttura che corrisponde a una semplice entità con una relazione ricorsiva con un attributo. Abbiamo dunque deciso di optare per quest'ultima operazione di traduzione che comporta una notevole semplificazione e una gestione efficiente delle risorse disponibili.

\begin{figure}[H]
\centering
%\includegraphics[width=1.0\textwidth]{Resources/ML.png}
\caption{Diagramma della Base di Dati dopo l'eliminazione delle Generalizzazioni}
\label{ML}
\end{figure}
\newpage

\subsection{Schema Relazionale}
Lo schema ristrutturato in Figura \ref{ML} contiene solamente costrutti mappabili in corrispettivi dello schema relazionale detto anche schema logico. Lo schema logico è rappresentato a seguire, dove l'asterisco dopo il nome degli attributi indica quelli che ammettono valori nulli.
\begin{itemize}
    \setlength{\itemindent}{+0in}
    \item \textbf{Pacco}(\underline{ID}, Tipologia, Dimensioni, Costo, DataOraOrdine, DataOraPrevista, Cliente, Corriere, TrackingId, TipoAssicurazione*, Dedica*, TipoCarta*)
        \begin{itemize}
            \setlength{\itemindent}{+.2in}
            \item Pacco.Cliente $\rightarrow$ Cliente.Email 
            \item Pacco.Corriere $\rightarrow$ Corriere.C.F.
            \item Pacco.TrackingId $\rightarrow$ Tracking.DataOra
        \end{itemize}
    \item \textbf{Bundle-Pacchi}(\underline{IdBundle, IdContenuto}, Quantità)
        \begin{itemize}
            \setlength{\itemindent}{+.2in}
            \item Bundle.IdBundle $\rightarrow$ Pacco.Id 
            \item Bundle.IdContenuto $\rightarrow$ Pacco.Id
        \end{itemize}
        
    \item \textbf{Corriere}(\underline{C.F.}, Agenzia, Grado, Disponibilità, NomeSede, CittàSede)
        \begin{itemize}
            \setlength{\itemindent}{+.2in}
            \item Corriere.(NomeSede, CittàSede) $\rightarrow$ Filiale.(Nome, Città)
        \end{itemize}
    \item \textbf{Filiale}(\underline{Nome, Città}, Tipo, Indirizzo)
    \item \textbf{Tracking}(\underline{IdPacco, DataOra}, Status, Note*, NomeCheckPoint,\\CittàCheckPoint)
        \begin{itemize}
                \setlength{\itemindent}{+.2in}
                \item Tracking.IdPacco $\rightarrow$ Pacco.Id
                \item Tracking.(NomeCheckPoint, CittàCheckPoint) $\rightarrow$ Filiale.(Nome, Città)
        \end{itemize}
    \item \textbf{Cliente}(\underline{Email}, Nome, Cognome, Indirizzo, Telefono*)
     \item \textbf{Sede}(\underline{Corriere, SedeNome, SedeCittà})
        \begin{itemize}
            \setlength{\itemindent}{+.2in}
            \item Sede.Corriere $\rightarrow$ Corriere.C.F.
            \item Sede.(SedeNome, SedeCittà) $\rightarrow$ Filiale.(Nome, Città)
        \end{itemize}
     
\end{itemize}
